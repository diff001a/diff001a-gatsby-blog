---
title: Gatsbyè£½ãƒ–ãƒ­ã‚°ã§ã‚µã‚¤ãƒˆå†…æ¤œç´¢ã‚’å®Ÿè£…ã—ã¾ã—ãŸ
date: 2019-10-25T00:00:00.000Z
description: Gatsbyã§ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«é™çš„ãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ç‚ºã€æ¤œç´¢çµæœãƒšãƒ¼ã‚¸ã®ã‚ˆã†ã«å…¥åŠ›ã•ã‚ŒãŸæ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦å‹•çš„ã«å†…å®¹ãŒå¤‰ã‚ã‚‹ã‚ˆã†ãªãƒšãƒ¼ã‚¸ã¯ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚ãªã®ã§æ¤œç´¢æ©Ÿèƒ½ã¯SaaSãªã©ã‚’åˆ©ç”¨ã—ã¦å®Ÿè£…ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã«ãªã£ã¦ã„ã‚‹ã¿ãŸã„ãªã‚“ã§ã™ãŒã€ã“ã¡ã‚‰ã®ãƒ–ãƒ­ã‚°ã§æ¤œç´¢æ©Ÿèƒ½ã‚’è‡ªå‰å®Ÿè£…ã™ã‚‹æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¦ã€å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã¨ã“ã‚æ€ã£ãŸä»¥ä¸Šã«æ‰‹è»½ã«ã§ããŸã®ã§ã€ä»Šå›ã®è¨˜äº‹ã§ã¯ãã®å®Ÿè£…ã®è¨˜éŒ²ã‚’æ®‹ã—ã¦ãŠããŸã„ã¨æ€ã„ã¾ã™ã€‚
slug: gatsby-site-search
tags:
  - React
  - Gatsby
keywords: JavaScript
---

Gatsbyã§ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«é™çš„ãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ç‚ºã€æ¤œç´¢çµæœãƒšãƒ¼ã‚¸ã®ã‚ˆã†ã«å…¥åŠ›ã•ã‚ŒãŸæ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦å‹•çš„ã«å†…å®¹ãŒå¤‰ã‚ã‚‹ã‚ˆã†ãªãƒšãƒ¼ã‚¸ã¯ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ãªã®ã§æ¤œç´¢æ©Ÿèƒ½ã¯SaaSãªã©ã‚’åˆ©ç”¨ã—ã¦å®Ÿè£…ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã«ãªã£ã¦ã„ã‚‹ã¿ãŸã„ãªã‚“ã§ã™ãŒã€[ã“ã¡ã‚‰ã®ãƒ–ãƒ­ã‚°](https://mottox2.com/posts/268)ã§æ¤œç´¢æ©Ÿèƒ½ã‚’è‡ªå‰å®Ÿè£…ã™ã‚‹æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¦ã€å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã¨ã“ã‚æ€ã£ãŸä»¥ä¸Šã«æ‰‹è»½ã«ã§ããŸã®ã§ã€ä»Šå›ã®è¨˜äº‹ã§ã¯ãã®å®Ÿè£…ã®è¨˜éŒ²ã‚’æ®‹ã—ã¦ãŠããŸã„ã¨æ€ã„ã¾ã™ã€‚

## å®Ÿè£…æ–¹æ³•

ä»¥ä¸‹ã®ã‚ˆã†ãªæ‰‹é †ã‚’è¸ã‚“ã§å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚

1. useStaticQueryã‚’ä½¿ã£ã¦æ¤œç´¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§å…¨è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹
2. æ¤œç´¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§æ¤œç´¢å‡¦ç†

å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸãƒ–ãƒ­ã‚°è¨˜äº‹ã§ã¯ã€ãƒ“ãƒ«ãƒ‰ã®åº¦ã«å…¨è¨˜äº‹åˆ†ã®æƒ…å ±ãŒæ ¼ç´ã•ã‚ŒãŸjsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã€ãã‚Œã‚’Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰axiosã‚’ä½¿ã£ã¦å–å¾—ã—ã¦ã„ã¾ã—ãŸãŒã€ä»Šå›ã¯`useStaticQuery`ã‚’åˆ©ç”¨ã—ã¦ã€æ¤œç´¢ç”¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã‹ã‚‰å…¨è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã¿ã‚‹äº‹ã«ã—ã¾ã—ãŸã€‚

## useStaticQueryã§å…¨è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—

```javascript
const tempData = useStaticQuery(graphql`
  query SearchData {
    allMarkdownRemark(
      sort: { fields: [frontmatter___date], order: DESC }
      limit: 1000
    ) {
      edges {
        node {
          frontmatter {
            title
            slug
            tags
            keywords
          }
        }
      }
    }
  }
`)
const [data, setData] = useState([])
useEffect(() => {
  const temp = []
  tempData.allMarkdownRemark.edges.map(e => {
    temp.push(e.node.frontmatter)
  })
  setData(temp)
}, [])
```

å…¨ä»¶å–å¾—ãªã®ã§ã€ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã§ä½¿ã†ã‚¯ã‚¨ãƒªã¨ã‚ˆãä¼¼ãŸæ„Ÿã˜ã®ã‚¯ã‚¨ãƒªã«ãªã‚Šã¾ã™ã€‚æ¤œç´¢å¯¾è±¡ã«ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚¿ã‚°ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚ãŸã„ã¨æ€ã£ã¦ã„ã‚‹ã®ã§ã€ãã®ä¸‰ã¤ã¨ã‚¹ãƒ©ãƒƒã‚°ã‚’GraphQLã‚’ä»‹ã—ã¦å–å¾—ã—ã¦ã€æ‰±ã„ã‚„ã™ã„å½¢ã«å¤‰æ›ã—ãŸã‚‚ã®ã‚’`data`ã«æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚`data`ã«å…¥ã£ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªå½¢ã«ãªã£ã¦ã„ã¾ã™ã€‚

```javascript
[
  {
    title: "Gatsbyè£½ãƒ–ãƒ­ã‚°ã§ã‚µã‚¤ãƒˆå†…æ¤œç´¢ã‚’å®Ÿè£…ã—ã¾ã—ãŸ",
    slug: "gatsby-site-search",
    tags: Array(2),
    keywords: "JavaScript",
  },
  {
    title: "VSCodeã®Marketplaceã«è‡ªä½œæ‹¡å¼µæ©Ÿèƒ½ã‚’å…¬é–‹ã™ã‚‹æ–¹æ³•",
    slug: "publish-vscode-extension",
    tags: Array(2),
    keywords: "é–‹ç™ºãƒ„ãƒ¼ãƒ«",
  }
]
```


## æ¤œç´¢å‡¦ç†

ã¾ãšã€æ¤œç´¢å¯¾è±¡ã«ã™ã‚‹ã‚¿ã‚¤ãƒˆãƒ«ãƒ»ã‚¿ã‚°ãƒ»ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä¸€ã¤ã®æ–‡å­—åˆ—ã¨ã—ã¦é€£çµã•ã›ã€ãã®æ–‡å­—åˆ—ãŒå…¥åŠ›ã•ã‚ŒãŸå€¤ã‚’å«ã‚€ã‹ã©ã†ã‹ã§filterã‚’ã‹ã‘ã¦ã„ã¾ã™ã€‚

```javascript
const [result, setResult] = useState([])
const search = () => {
  const value = props.value.toLowerCase()
  const temp = data.filter(e => {
    const target = `
      ${e.title.toLowerCase()}
      ${e.tags.join(" ").toLowerCase()}
      ${e.keywords.toLowerCase()}
    `
    return target.indexOf(value) !== -1
  })
  setResult(temp)
}
useEffect(() => {
  if (props.value !== "") {
    search()
  }
}, [props.value])
```

æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰(`props.value`)ãŒå¤‰æ›´ã•ã‚Œã‚‹åº¦ã«æ¤œç´¢å‡¦ç†ãŒèµ°ã‚Šã€`result`ã«ã¯æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€è¨˜äº‹ã ã‘ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚ã‚ã¨ã¯ã“ã‚Œã‚’è¡¨ç¤ºã•ã›ã‚‹UIã‚’ä½œã‚Œã°å®Œäº†ã§ã™ğŸ™†â€

## æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã›ã¦ã¿ã‚‹

ã‚¿ã‚¤ãƒˆãƒ«ã«å«ã¾ã‚Œã‚‹æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’æŠœãå‡ºã—ã¦ã€spanã‚¿ã‚°ã§å›²ã‚“ã ã‚‚ã®ã«ç½®ãæ›ãˆã‚‹ã¨ã„ã†ã ã‘ã®ç°¡å˜ãªä½œã‚Šã§ã™ãŒã€ã¡ã‚‡ã£ã¨è¦‹ãŸç›®ãŒè¯ã‚„ã‹ã«ãªã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ãªã¨æ€ã„ã¾ã™ğŸ’…âœ¨

```javascript
const TextHighlighter = props => {
  const { str, includes } = props
  const temp = str.toLowerCase()
  const start = temp.indexOf(includes.toLowerCase())
  const end = start + includes.length
  const item = str.slice(start, end)
  const res = str.replace(
    item,
    `<span style="background: rgba(255, 250, 118, 0.4); padding: 3px 0">${item}</span>`
  )
  return <span dangerouslySetInnerHTML={{ __html: res }} />
}
```

å‘¼ã³å‡ºã™æ™‚ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™â†“
strã«ã‚¿ã‚¤ãƒˆãƒ«ã€includesã«æ¤œç´¢æ–‡å­—åˆ—ã‚’æ¸¡ã—ã¾ã™ã€‚

```javascript
<TextHighLighter str={post.title} includes={props.value} />
```

## é›‘æ„Ÿ

[å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã¯ã“ã¡ã‚‰ã‹ã‚‰ï¼](https://github.com/diff001a/diff001a-gatsby-blog/blob/master/src/components/search/index.js)

æœ€åˆã¯ãƒ“ãƒ«ãƒ‰ã®åº¦ã«jsonã‚’ç”Ÿæˆã™ã‚‹æ–¹æ³•ã§å®Ÿè£…ã—ã¦ã„ãŸã‚“ã§ã™ãŒã€useStaticQueryã‚’ä½¿ã†æ–¹æ³•ã§ä½œã‚Šç›´ã—ã¦ã¿ãŸã®ã§ã€ãã‚Œã«ä¼´ã„è¨˜äº‹ã®å†…å®¹ã‚‚å¤‰æ›´ã—ã¾ã—ãŸã€‚

ã‚·ãƒ³ãƒ—ãƒ«ãªè¨˜è¿°ã®ã¿ã§å®Ÿè£…ã§ãã‚‹ã®ã§ã€å€‹äººãƒ–ãƒ­ã‚°ã®æ¤œç´¢æ©Ÿèƒ½ç¨‹åº¦ã§ã‚ã‚Œã°[Gatsbyã®å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚¬ã‚¤ãƒ‰](https://www.gatsbyjs.org/docs/adding-search/)ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹SaaSã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ã‚ˆã‚Šã‚‚è‡ªå‰å®Ÿè£…ã®æ–¹ãŒæ—©ã„ã‚“ã˜ã‚ƒãªã„ã‹ãªï¼Ÿã¨ã„ã†æ°—ã•ãˆã—ã¦ã„ã¾ã™ã€‚ã„ã‚ã„ã‚ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚‚ã—ã‚„ã™ã„ã§ã™ã—ã€ãŠã™ã™ã‚ã§ã™ã€‚