---
title: Gatsbyè£½ãƒ–ãƒ­ã‚°ã§ã‚µã‚¤ãƒˆå†…æ¤œç´¢ã‚’å®Ÿè£…ã—ã¾ã—ãŸ
date: 2019-09-28T00:00:00.000Z
description: Gatsbyã§ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«é™çš„ãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ç‚ºã€æ¤œç´¢çµæœãƒšãƒ¼ã‚¸ã®ã‚ˆã†ã«å…¥åŠ›ã•ã‚ŒãŸæ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦å‹•çš„ã«å†…å®¹ãŒå¤‰ã‚ã‚‹ã‚ˆã†ãªãƒšãƒ¼ã‚¸ã¯ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚ãªã®ã§æ¤œç´¢æ©Ÿèƒ½ã¯SaaSãªã©ã‚’åˆ©ç”¨ã—ã¦å®Ÿè£…ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã«ãªã£ã¦ã„ã‚‹ã¿ãŸã„ãªã‚“ã§ã™ãŒã€ã“ã¡ã‚‰ã®ãƒ–ãƒ­ã‚°ã§æ¤œç´¢æ©Ÿèƒ½ã‚’è‡ªå‰å®Ÿè£…ã™ã‚‹æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¦ã€å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã¨ã“ã‚æ€ã£ãŸä»¥ä¸Šã«æ‰‹è»½ã«ã§ããŸã®ã§ã€ä»Šå›ã®è¨˜äº‹ã§ã¯ãã®å®Ÿè£…ã®è¨˜éŒ²ã‚’æ®‹ã—ã¦ãŠããŸã„ã¨æ€ã„ã¾ã™ã€‚
slug: gatsby-site-search
tags: 
	- Gatsby
keywords: gatsby
---

Gatsbyã§ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«é™çš„ãƒšãƒ¼ã‚¸ã‚’ç”Ÿæˆã™ã‚‹ç‚ºã€æ¤œç´¢çµæœãƒšãƒ¼ã‚¸ã®ã‚ˆã†ã«å…¥åŠ›ã•ã‚ŒãŸæ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã«ã‚ˆã£ã¦å‹•çš„ã«å†…å®¹ãŒå¤‰ã‚ã‚‹ã‚ˆã†ãªãƒšãƒ¼ã‚¸ã¯ç”Ÿæˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ãªã®ã§æ¤œç´¢æ©Ÿèƒ½ã¯SaaSãªã©ã‚’åˆ©ç”¨ã—ã¦å®Ÿè£…ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã«ãªã£ã¦ã„ã‚‹ã¿ãŸã„ãªã‚“ã§ã™ãŒã€[ã“ã¡ã‚‰ã®ãƒ–ãƒ­ã‚°](https://mottox2.com/posts/268)ã§æ¤œç´¢æ©Ÿèƒ½ã‚’è‡ªå‰å®Ÿè£…ã™ã‚‹æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¦ã€å‚è€ƒã«ã•ã›ã¦ã„ãŸã ã„ãŸã¨ã“ã‚æ€ã£ãŸä»¥ä¸Šã«æ‰‹è»½ã«ã§ããŸã®ã§ã€ä»Šå›ã®è¨˜äº‹ã§ã¯ãã®å®Ÿè£…ã®è¨˜éŒ²ã‚’æ®‹ã—ã¦ãŠããŸã„ã¨æ€ã„ã¾ã™ã€‚

## å®Ÿè£…æ–¹æ³•

[ã“ã¡ã‚‰ã®ãƒ–ãƒ­ã‚°](https://mottox2.com/posts/268)ã§ç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹æ–¹æ³•ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸï¼ä»¥ä¸‹ã®ã‚ˆã†ãªæ‰‹é †ã§ã™ã€‚

1. æ¤œç´¢ç”¨ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ãŠãã€ãƒ“ãƒ«ãƒ‰æ™‚ã«å†…å®¹ã‚’æ›´æ–°ã™ã‚‹
2. Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰JSONã‚’å‘¼ã³å‡ºã™
3. Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§æ¤œç´¢å‡¦ç†

æ¤œç´¢ç”¨ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ“ãƒ«ãƒ‰ã®åº¦ã«æ›´æ–°ã™ã‚‹ã¨ã„ã†ã®ãŒæ–¬æ–°ãªã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ã§ã™ã‚ˆã­ï¼ã“ã®æ–¹æ³•ã§ã‚ã‚Œã°ç¢ºã‹ã«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãªã—ã§æ¤œç´¢æ©Ÿèƒ½ãŒå®Ÿè£…ã§ããã†ã§ã™âœ¨

## æ¤œç´¢ç”¨ã®JSONã‚’ç”Ÿæˆ & ãƒ“ãƒ«ãƒ‰æ™‚ã«å†…å®¹ã‚’æ›´æ–°ã™ã‚‹è¨­å®š

ã¾ãšã¯ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç›´ä¸‹ã«**static**ã¨ã„ã†ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã£ã¦ã€ãã®ä¸­ã«**search.json**ã¨ã„ã†åå‰ã®ç©ºã®jsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¦ãŠãã¾ã™ã€‚

ãã‚Œã‹ã‚‰ã€**gatsby-node.js**å†…ã®**createPages**ã®ä¸­ã«ä»¥ä¸‹ã®ã‚ˆã†ãªå‡¦ç†ã‚’è¿½åŠ ã—ã¦ã€ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã³ã«**search.json**ã®å†…å®¹ãŒæ›¸ãæ›ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ãŠãã¾ã™ã€‚

```javascript
// "posts" ã«ã¯GraphQLã‚’ä»‹ã—ã¦å–å¾—ã—ãŸå…¨è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ãŒæ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ //
const searchJSON = posts.map(post => {
  const { title, slug, tags, keywords } = post.node.frontmatter
  return {
    title,
    keywords,
    tags,
    path: `/${slug}/`,
  }
})
fs.writeFileSync("./static/search.json", JSON.stringify(searchJSON, null, 2))
```

ã“ã‚Œã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€**search.json**ã®å†…å®¹ãŒä»¥ä¸‹ã®ã‚ˆã†ãªæ„Ÿã˜ã«æ›¸ãæ›ãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

```json
[
  {
    "title": "Gatsbyè£½ãƒ–ãƒ­ã‚°ã§ã‚µã‚¤ãƒˆå†…æ¤œç´¢ã‚’å®Ÿè£…ã—ã¾ã—ãŸ",
    "keywords": "gatsby",
    "tags": [
      "Gatsby"
    ],
    "path": "/gatsby-site-search/"
  },
  {
    "title": "Gatsby + Markdownã§ãƒ–ãƒ­ã‚°ã‚’ä½œã‚Šç›´ã—ã¾ã—ãŸ",
    "keywords": "gatsby",
    "tags": [
      "Gatsby",
      "Markdown"
    ],
    "path": "/gatsby-blog-with-markdown/"
  },
  ...
]
```

## Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰jsonãƒ‡ãƒ¼ã‚¿ã‚’å‘¼ã³å‡ºã™

Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰jsonãƒ‡ãƒ¼ã‚¿ã‚’å‘¼ã³å‡ºã™ç‚ºã«[axios](https://github.com/axios/axios)ã¨ã„ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã„ã¾ã™

```javascript
const [data, setData] = useState([])
const getData = async () => {
  const res = await axios.get("/search.json")
  setData(res.data)
}
useEffect(() => {
  getData()
}, [])
```
ã“ã‚Œã§`data`ã«å…¨è¨˜äº‹åˆ†ã®æƒ…å ±ãŒæ ¼ç´ã•ã‚Œã‚‹ã®ã§ã€æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã§filterã™ã‚‹å‡¦ç†ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚

## æ¤œç´¢å‡¦ç†

ã“ã®ãƒ–ãƒ­ã‚°ã§ã¯ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚¿ã‚°ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ¤œç´¢å¯¾è±¡ã«ã™ã‚‹ã“ã¨ã«ã—ãŸã®ã§ã€ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚¿ã‚°ã¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¸€ã¤ã®æ–‡å­—åˆ—ã¨ã—ã¦é€£çµã•ã›ã€ãã®æ–‡å­—åˆ—ãŒå…¥åŠ›ã•ã‚ŒãŸå€¤ã‚’å«ã‚€ã‹ã©ã†ã‹ã§filterã‚’ã‹ã‘ã¦ã„ã¾ã™ã€‚

```javascript
const [result, setResult] = useState(data)
const search = () => {
  const value = props.value.toLowerCase()
  const temp = data.filter(e => {
    const target = `
      ${e.title.toLowerCase()}
      ${e.tags.join(" ").toLowerCase()}
      ${e.keywords.toLowerCase()}
     `
    return target.indexOf(value) !== -1
  })
  setResult(temp)
}
useEffect(() => {
  if (props.value !== "") {
    search()
  }
}, [props.value])
```

æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰(`props.value`)ãŒå¤‰æ›´ã•ã‚Œã‚‹åº¦ã«æ¤œç´¢å‡¦ç†ãŒèµ°ã‚Šã€`result`ã«ã¯æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å«ã‚€è¨˜äº‹ã ã‘ãŒæ ¼ç´ã•ã‚Œã¾ã™ã€‚ã‚ã¨ã¯ã“ã‚Œã‚’è¡¨ç¤ºã•ã›ã‚‹UIã‚’ä½œã‚Œã°å®Œäº†ã§ã™ğŸ™†â€

## æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã›ã¦ã¿ã‚‹

ã‚¿ã‚¤ãƒˆãƒ«ã«å«ã¾ã‚Œã‚‹æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’æŠœãå‡ºã—ã¦ã€spanã‚¿ã‚°ã§å›²ã‚“ã ã‚‚ã®ã«ç½®ãæ›ãˆã‚‹ã¨ã„ã†ã ã‘ã®ç°¡å˜ãªä½œã‚Šã§ã™ãŒã€ã¡ã‚‡ã£ã¨è¦‹ãŸç›®ãŒè¯ã‚„ã‹ã«ãªã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ãªã¨æ€ã„ã¾ã™ğŸ’…âœ¨

```javascript
const TextHighlighter = props => {
  const { str, includes } = props
  const temp = str.toLowerCase()
  const start = temp.indexOf(includes.toLowerCase())
  const end = start + includes.length
  const item = str.slice(start, end)
  const res = str.replace(
    item,
    `<span style="background: rgba(255, 250, 118, 0.4); padding: 3px 0">${item}</span>`
  )
  return <span dangerouslySetInnerHTML={{ __html: res }} />
}
```

å‘¼ã³å‡ºã™æ™‚ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™â†“
strã«ã‚¿ã‚¤ãƒˆãƒ«ã€includesã«æ¤œç´¢æ–‡å­—åˆ—ã‚’æ¸¡ã—ã¾ã™ã€‚

```javascript
<TextHighLighter str={post.title} includes={props.value} />
```

## é›‘æ„Ÿ

ã‚µã‚¤ãƒˆå†…æ¤œç´¢ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‚‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¸€åˆ‡ãªã—ã§Gatsbyã ã‘ã§å®Ÿè£…ã§ãã‚‹ã¨ã„ã†ã¨ã“ã‚ãŒå€‹äººçš„ã«ã¯å¤§ããªç™ºè¦‹ã§ã€å‹‰å¼·ã«ãªã‚Šã¾ã—ãŸã€‚

[Gatsbyã®å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚¬ã‚¤ãƒ‰](https://www.gatsbyjs.org/docs/adding-search/)ã§ã¯SaaSã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹æ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€è‡ªåˆ†ã®èˆˆå‘³ã«åˆã‚ã›ã¦å®Ÿè£…æ–¹æ³•ã‚’é¸ã¹ã°ã„ã„ã®ã‹ãªã¨æ€ã„ã¾ã™ã€‚